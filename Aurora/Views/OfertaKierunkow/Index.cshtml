@using Aurora.Enums
@using Aurora.Utils
@model IEnumerable<KierunekStudiow>
@{
    ViewData["Title"] = "Oferta";
}

<body>


    <div class="row">
        <div class="col-md-4" style="margin-right: 10px; margin-bottom: 20px;">
            <div class="form-inline pull-left" >
                    @using (Html.BeginForm("Index", "OfertaKierunkow", FormMethod.Get, new { @class = "form-group", id = "searchForm" }))
                    {
                    <div class="custom-dropdown">
                        <label for="txtSearchFilter">Wyszukaj kierunek:</label>
                        <input type="text" class="form-control" placeholder="Wyszukaj kierunek" id="txtSearchFilter" name="searchFilter" value="@ViewBag.SearchFilter" />
                        <button type="submit" class="btn btn-secondary">Szukaj</button>
                        <button type="button" class="btn btn-secondary" onclick="clearFilters()">Usuń filtry</button>
                            @Html.Hidden("filterPoziom", TempData["FilterPoziom"])
                            @Html.Hidden("filterForma", TempData["FilterForma"])
                            @Html.Hidden("filterJezyk", TempData["FilterJezyk"])
                            @Html.Hidden("filterWydzial", TempData["FilterWydzial"])
                            @Html.Hidden("filterMiejsce", TempData["FilterMiejsce"])
                    </div>

                    }
            </div>
        </div>
        <div class="col-md-8">
            <div class="form-inline pull-right">
                    @using (Html.BeginForm("index", "OfertaKierunkow", FormMethod.Get, new { @class = "form-group", id = "filterForm" }))
                    {

                    <div class="custom-dropdown">

                        <label for="filterPoziom">Poziom studiów:</label>
                            @Html.DropDownList("filterPoziom", new SelectList(ViewBag.FilterOptionsPoziom, "Value", "Text", ViewBag.SelectedFilterPoziom), new { onchange = "submitFilterForm();", @value = ViewBag.SelectedFilterPoziom, style = "width: 200px; margin-right: 5px;" })
                    </div>
                    <div class="custom-dropdown">
                        <label for="filterForma">Forma studiów:</label>
                        @Html.DropDownList("filterForma", new SelectList(ViewBag.FilterOptionsForma, "Value", "Text", ViewBag.SelectedFilterForma), new { onchange = "submitFilterForm();", @value = ViewBag.SelectedFilterForma, style = "width: 200px; margin-right: 5px;" })
                    </div>
                    <div class="custom-dropdown">
                        <label for="filterJezyk">Język wykładowy:</label>
                        @Html.DropDownList("filterJezyk", new SelectList(ViewBag.FilterOptionsJezyk, "Value", "Text", ViewBag.SelectedFilterJezyk), new { onchange = "submitFilterForm();", @value = ViewBag.SelectedFilterJezyk, style = "width: 200px; margin-right: 5px;" })
                    </div>
                    <div class="custom-dropdown">
                        <label for="filterWydzial">Wydział kierunku</label>
                        @Html.DropDownList("filterWydzial", new SelectList(ViewBag.FilterOptionsWydzial, "Value", "Text", ViewBag.SelectedFilterWydzial), new { onchange = "submitFilterForm();", @value = ViewBag.SelectedFilterWydzial, style = "width: 200px; margin-right: 5px;" })
                    </div>
                    <div class="custom-dropdown">
                        <label for="filterOption1">Miejsce studiów:</label>
                        @Html.DropDownList("filterMiejsce", new SelectList(ViewBag.FilterOptionsMiejsce, "Value", "Text", ViewBag.SelectedFilterMiejsce), new { onchange = "submitFilterForm();", @value = ViewBag.SelectedFilterMiejsce, style = "width: 200px; margin-right: 5px;" })
                    </div>


                    <input type="hidden" name="searchFilter" value="@ViewBag.SearchFilter" />
                    <input type="hidden" name="filterPoziom" value="@TempData["FilterPoziom"]" />
                    <input type="hidden" name="filterForma" value="@TempData["FilterForma"]" />
                    <input type="hidden" name="filterJezyk" value="@TempData["FilterJezyk"]" />
                    <input type="hidden" name="filterWydzial" value="@TempData["FilterWydzial"]" />
                    <input type="hidden" name="filterMiejsce" value="@TempData["FilterMiejsce"]" />
                    }
            </div>
        </div>

    </div>

    @if (Model.Any())

    {
        <div class="row">
            <table class="table">
                <thead>
                <th> </th>
                </thead>
                <tbody>
                    @foreach (var kierunek in Model)
                    {
                        <tr class="application-row">
                            <td class="my-td">Kierunek: @kierunek.NazwaKierunku</td>
                            <td class="my-td">Forma studiów: @(EnumUtils.ConvertIDToTypeAsString<FormaStudiow>(kierunek.FormaStudiow)) </td>
                            <td class="my-td">
                                <form asp-action="WyliczWspolczynnik" asp-route-id="@kierunek.ID" method="get" style="display: inline-block;">
                                    <button type="submit" class="btn btn-secondary">Wylicz współczynnik</button>
                                </form>
                            </td>
                            <td class="my-td"> <button class="btn btn-secondary" style="margin-right: 5px; width: 100%">Procedury rekrutacji</button></td>
                            <td class="my-td"> <button class="btn btn-secondary" style="margin-right: 5px; width: 100%">Aplikuj</button></td>
                        </tr>

                        <tr class="application-row">
                            <td class="my-td">@(EnumUtils.ConvertIDToTypeAsString<NazwaWydzialu>(kierunek.Wydzial)) </td>
                            <td class="my-td">Poziom studiów:  @(EnumUtils.ConvertIDToTypeAsString<PoziomStudiow>(kierunek.PoziomStudiow)) </td>
                            <td class="my-td"> <button class="btn btn-secondary" style="margin-right: 5px; width: 100%">Terminy rekrutacji</button></td>
                            <td class="my-td"> <button class="btn btn-secondary" style="margin-right: 5px; width: 100%">Progi punktowe</button></td>
                            <td class="my-td"></td>
                        </tr>

                        <tr class="application-row">
                            <td class="my-td">Dodaj do ulubionych</td>
                            <td class="my-td">Język wykładowy: @(EnumUtils.ConvertIDToTypeAsString<Jezyk>(kierunek.JezykWykladowy))</td>
                            <td class="my-td"></td>
                            <td class="my-td"></td>
                            <td class="my-td"></td>
                        </tr>

                        <tr class="application-row" style="height: 40px;"></tr>
                    }
                </tbody>
            </table>
        </div>


    }
    else
    {
        <p style="padding: 20px; text-align: center">@ViewBag.PopUpMessage</p>
    }


    @if (ViewBag.PopUpMessage != null)
    {
        <div class="modal fade" id="myModal">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h4 class="modal-title"></h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <div class="modal-body">
                        <p style="text-align: center">@ViewBag.PopUpMessage</p>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Zamknij</button>
                    </div>

                </div>
            </div>
        </div>

        <script>
            $(document).ready(function () {
                var popUpMessage = '@Html.Raw(ViewBag.PopUpMessage)';

                if (popUpMessage.trim() !== '') {
                    $('#myModal').modal('show');
                }
            });
        </script>
    }

</body>

<script>
    function submitFilterForm() {
        document.getElementById("filterForm").submit();
        document.getElementById("searchForm").elements["filterPoziom"].value = document.getElementById("filterPoziom").value;
        document.getElementById("searchForm").elements["filterForma"].value = document.getElementById("filterForma").value;
        document.getElementById("searchForm").elements["filterJezyk"].value = document.getElementById("filterJezyk").value;
        document.getElementById("searchForm").elements["filterWydzial"].value = document.getElementById("filterWydzial").value;
        document.getElementById("searchForm").elements["filterMiejsce"].value = document.getElementById("filterMiejsce").value;

</script>




